// position to highlight for preterite
const posPret3C = {
  "3cs": [1, 2, 4],
  "2ms": [2, 3, 5],
  "2fs": [2, 3, 5],
  "1cs": [1, 2, 4],
  "3mp": [1, 2, 4],
  "3fp": [1, 2, 4],
  "2cp": [2, 3, 5],
  "1cp": [2, 3, 5]
};

const posPretIIIweak = {
  "3cs": [1, 2],
  "2ms": [2, 3],
  "2fs": [2, 3],
  "1cs": [1, 2],
  "3mp": [1, 2],
  "3fp": [1, 2],
  "2cp": [2, 3],
  "1cp": [2, 3]
};

const posPretIweak = {
  "3cs": [1, 3],
  "2ms": [2, 4],
  "2fs": [2, 4],
  "1cs": [1, 3],
  "3mp": [1, 3],
  "3fp": [1, 3],
  "2cp": [2, 4],
  "1cp": [2, 4]
};

const posPretalakum = {
  "3cs": [2, 4],
  "2ms": [3, 5],
  "2fs": [3, 5],
  "1cs": [2, 4],
  "3mp": [2, 4],
  "3fp": [2, 4],
  "2cp": [3, 5],
  "1cp": [3, 5]
};

const posPretIIweak = {
  "3cs": [1, 3],
  "2ms": [2, 4],
  "2fs": [2, 4],
  "1cs": [1, 3],
  "3mp": [1, 3],
  "3fp": [1, 3],
  "2cp": [2, 4],
  "1cp": [2, 4]
};

const posPretIw = {
  "3cs": [1, 3],
  "2ms": [2, 4],
  "2fs": [2, 3],
  "1cs": [1, 3],
  "3mp": [1, 2],
  "3fp": [1, 2],
  "2cp": [2, 3],
  "1cp": [2, 4]
};

const posPretIwVentive = {
  "3cs": [1, 2],
  "2ms": [2, 3],
  "2fs": [2, 3],
  "1cs": [1, 2],
  "3mp": [1, 2],
  "3fp": [1, 2],
  "2cp": [2, 3],
  "1cp": [2, 3]
};

// position to highlight for durative
const posDur3C = {
  "3cs": [1, 4, 6],
  "2ms": [2, 5, 7],
  "2fs": [2, 5, 7],
  "1cs": [1, 4, 6],
  "3mp": [1, 4, 6],
  "3fp": [1, 4, 6],
  "2cp": [2, 5, 7],
  "1cp": [2, 5, 7]
};

const posDurIIIweak = {
  "3cs": [1, 4],
  "2ms": [2, 5],
  "2fs": [2, 5],
  "1cs": [1, 4],
  "3mp": [1, 4],
  "3fp": [1, 4],
  "2cp": [2, 5],
  "1cp": [2, 5]
};

const posDurIweak = {
  "3cs": [2, 4],
  "2ms": [3, 5],
  "2fs": [3, 5],
  "1cs": [2, 4],
  "3mp": [2, 4],
  "3fp": [2, 4],
  "2cp": [3, 5],
  "1cp": [3, 5]
};

const posDurIIweak = {
  "3cs": [1, 4],
  "2ms": [2, 5],
  "2fs": [2, 5],
  "1cs": [1, 4],
  "3mp": [1, 4],
  "3fp": [1, 4],
  "2cp": [2, 5],
  "1cp": [2, 5]
};

const posDurIw = {
  "3cs": [2, 4],
  "2ms": [3, 5],
  "2fs": [3, 5],
  "1cs": [2, 4],
  "3mp": [2, 4],
  "3fp": [2, 4],
  "2cp": [3, 5],
  "1cp": [3, 5]
};

// position to highlight for perfect
const posPerf3C = {
  "3cs": [1, 4, 6],
  "2ms": [2, 5, 7],
  "2fs": [2, 5, 6],
  "1cs": [1, 4, 6],
  "3mp": [1, 4, 5],
  "3fp": [1, 4, 5],
  "2cp": [2, 5, 6],
  "1cp": [2, 5, 7]
};

const posPerfIweak = {
  "3cs": [3, 5],
  "2ms": [4, 6],
  "2fs": [4, 5],
  "1cs": [3, 5],
  "3mp": [3, 4],
  "3fp": [3, 4],
  "2cp": [4, 5],
  "1cp": [4, 6]
};

const posPerfIwActive = {
  "3cs": [4, 6],
  "2ms": [5, 7],
  "2fs": [5, 6],
  "1cs": [4, 6],
  "3mp": [4, 5],
  "3fp": [4, 5],
  "2cp": [5, 6],
  "1cp": [5, 7]
};

const posPerfIwStative = {
  "3cs": [3, 5],
  "2ms": [4, 6],
  "2fs": [4, 5],
  "1cs": [3, 5],
  "3mp": [3, 4],
  "3fp": [3, 4],
  "2cp": [4, 5],
  "1cp": [4, 6]
};

const posPretNoVentBabalum = {
  "3cs": [1, 3],
  "2ms": [2, 4],
  "2fs": [2, 3, 8, 10],
  "1cs": [1, 3],
  "3mp": [1, 2, 6, 8],
  "3fp": [1, 2, 6, 8],
  "2cp": [2, 3, 8, 10],
  "1cp": [2, 4]
};

const posPretVentBabalum = {
  "3cs": [1, 2],
  "2ms": [2, 3],
  "2fs": [2, 3],
  "1cs": [1, 2],
  "3mp": [1, 2],
  "3fp": [1, 2],
  "2cp": [2, 3],
  "1cp": [2, 3]
};

const posImpNoVent3C = {
  "2ms": [0, 2, 4],
  "2fs": [0, 2, 3],
  "2cp": [0, 2, 3]
};

const posImpVent3C = {
  "2ms": [0, 2, 3],
  "2fs": [0, 2, 3],
  "2cp": [0, 2, 3]
};

const posImpNoVentIweak = {
  "2ms": [1, 3],
  "2fs": [1, 2],
  "2cp": [1, 2]
};
const posImpVentIweak = {
  "2ms": [1, 2],
  "2fs": [1, 2],
  "2cp": [1, 2]
};

const posImpIInIIIweak = {
  "2ms": [0, 2],
  "2fs": [0, 2],
  "2cp": [0, 2]
};

const posImpIw = {
  "2ms": [0, 2],
  "2fs": [0, 2],
  "2cp": [0, 2]
};

const posPrec3C = {
  "3cs": [2, 3, 5],
  "1cs": [2, 3, 5],
  "3mp": [2, 3, 5],
  "3fp": [2, 3, 5],
  "1cp": [4, 5, 7]
};

const posPrecInIIweak = {
  "3cs": [2, 4],
  "1cs": [2, 4],
  "3mp": [2, 4],
  "3fp": [2, 4],
  "1cp": [4, 6]
};

const posPrecIIIweak = {
  "3cs": [2, 3],
  "1cs": [2, 3],
  "3mp": [2, 3],
  "3fp": [2, 3],
  "1cp": [4, 5]
};

const posPrecNoVentIweak = {
  "3cs": [2, 4],
  "1cs": [2, 4],
  "3mp": [2, 4],
  "3fp": [2, 4],
  "1cp": [4, 6]
};

const posPrecVentIweak = {
  "3cs": [2, 3],
  "1cs": [2, 3],
  "3mp": [2, 4],
  "3fp": [2, 4],
  "1cp": [4, 5]
};

const verbalAdjective = {
  sound: {
    masculin: [0, 2, 3],
    feminin: [0, 2, 4],
    radical: [0, 2, 4]
  },
  Iweak: {
    masculin: [1, 2],
    feminin: [1, 3],
    radical: [1, 3]
  },
  IIweak: {
    masculin: [0, 2],
    feminin: [0, 2],
    radical: [0, 2]
  },
  IIIweak: {
    masculin: [0, 2],
    feminin: [0, 2],
    radical: [0, 2]
  },
  Iw: {
    masculin: [2, 3],
    feminin: [2, 4],
    radical: [2, 4]
  }
};

const posParticiple = {
  masculin: [0, 2, 4],
  feminin: [0, 2, 4],
  radical: [0, 2, 4]
};

const posParticipleIIw = {
  masculin: [0, 2],
  feminin: [0, 2],
  radical: [0, 2]
};

const highlightVerb = (verb, ps, template) => {
  return [...verb].map((letter, i) => {
    if (template[ps].includes(i)) {
      // if this is a position to highlight
      return "<strong>" + letter + "</strong>";
    } else {
      // if the position is not to be highlighted
      return letter;
    }
  });
};

const highlightRoot = ({
  verb,
  root,
  conjugation,
  ps,
  infinitive,
  ventive,
  wVerbType,
  vetitive
}) => {
  let highlightedVerb = [];
  let vetitivePrefix = undefined;

  if (conjugation === "gPreterite") {
    // we remove vetitive prefix before highlighting the root
    if (vetitive) {
      if (verb[0] === "ē") {
        verb = verb.slice(1);
        vetitivePrefix = "ē";
      } else {
        verb = verb.slice(3);
        vetitivePrefix = "ayy";
      }
    }
    // 3 consonant root
    if (!root.includes("Ø") && root[0] !== "w" && infinitive !== "babālum") {
      highlightedVerb = highlightVerb(verb, ps, posPret3C);
    } else if (root[0] === "Ø") {
      highlightedVerb = [...verb].map((letter, i) => {
        if (infinitive === "alākum") {
          if (posPretalakum[ps].includes(i)) {
            // if this is a position to highlight
            return "<strong>" + letter + "</strong>";
          } else {
            // if the position is not to be highlighted
            return letter;
          }
        } else {
          if (posPretIweak[ps].includes(i)) {
            // if this is a position to highlight
            return "<strong>" + letter + "</strong>";
          } else {
            // if the position is not to be highlighted
            return letter;
          }
        }
      });
    } else if (root[1] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posPretIIweak);
    } else if (root[2] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posPretIIIweak);
    } else if (root[0] === "w" && ventive === false) {
      highlightedVerb = highlightVerb(verb, ps, posPretIw);
    } else if (root[0] === "w" && ventive == true && wVerbType === "active") {
      highlightedVerb = highlightVerb(verb, ps, posPretIwVentive);
    } else if (root[0] === "w" && ventive == true && wVerbType === "stative") {
      highlightedVerb = highlightVerb(verb, ps, posPretIw);
    } else if (infinitive === "babālum" && ventive === false) {
      highlightedVerb = highlightVerb(verb, ps, posPretNoVentBabalum);
    } else if (infinitive === "babālum" && ventive === true) {
      highlightedVerb = highlightVerb(verb, ps, posPretVentBabalum);
    } else {
      highlightedVerb = [...verb];
    }
  } else if (conjugation === "gDurative") {
    if (!root.includes("Ø") && root[0] !== "w") {
      highlightedVerb = highlightVerb(verb, ps, posDur3C);
    } else if (root[0] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posDurIweak);
    } else if (root[1] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posDurIIweak);
    } else if (root[2] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posDurIIIweak);
    } else if (root[0] === "w") {
      highlightedVerb = highlightVerb(verb, ps, posDurIw);
    } else {
      highlightedVerb = [...verb];
    }
  } else if (conjugation === "gImperative") {
    if (!root.includes("Ø") && root[0] !== "w") {
      if (ventive) {
        let schemeVent = { ...posImpVent3C };
        if (root[0] === "n") {
          // imperative of verbs starting with n- lose their n-
          for (let person in schemeVent) {
            schemeVent[person] = [
              schemeVent[person][1] - 1,
              schemeVent[person][2] - 1
            ];
          }
        }
        highlightedVerb = highlightVerb(verb, ps, schemeVent);
      } else {
        let schemeNoVent = { ...posImpNoVent3C };
        if (root[0] === "n") {
          // imperative of verbs starting with n- lose their n-
          for (let person in schemeNoVent) {
            schemeNoVent[person] = [
              schemeNoVent[person][1] - 1,
              schemeNoVent[person][2] - 1
            ];
          }
        }
        highlightedVerb = highlightVerb(verb, ps, schemeNoVent);
      }
    } else if (root[0] === "Ø") {
      if (ventive) {
        highlightedVerb = highlightVerb(verb, ps, posImpVentIweak);
      } else {
        highlightedVerb = highlightVerb(verb, ps, posImpNoVentIweak);
      }
    } else if (root[1] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posImpIInIIIweak);
    } else if (root[2] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posImpIInIIIweak);
    } else if (root[0] === "w") {
      highlightedVerb = highlightVerb(verb, ps, posImpIw);
    } else {
      highlightedVerb = [...verb];
    }
  } else if (conjugation === "gPrecative") {
    if (!root.includes("Ø") && root[0] !== "w") {
      highlightedVerb = highlightVerb(verb, ps, posPrec3C);
    } else if (root[0] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posPrecInIIweak);
    } else if (root[1] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posPrecInIIweak);
    } else if (root[2] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posPrecIIIweak);
    } else if (root[0] === "w") {
      if (ventive) {
        highlightedVerb = highlightVerb(verb, ps, posPrecVentIweak);
      } else {
        highlightedVerb = highlightVerb(verb, ps, posPrecNoVentIweak);
      }
    } else {
      highlightedVerb = [...verb];
    }
  } else if (conjugation === "gPerfect") {
    if (!root.includes("Ø") && root[0] !== "w") {
      highlightedVerb = highlightVerb(verb, ps, posPerf3C);
    } else if (root[0] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posPerfIweak);
    } else if (root[1] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posDurIIweak);
    } else if (root[2] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posDurIIIweak);
    } else if (root[0] === "w") {
      if (wVerbType === "active") {
        highlightedVerb = highlightVerb(verb, ps, posPerfIwActive);
      } else if (wVerbType === "stative") {
        highlightedVerb = highlightVerb(verb, ps, posPerfIwStative);
      }
    } else {
      highlightedVerb = [...verb];
    }
  } else if (conjugation === "verbalAdjective") {
    // we store the non attested status to add it back after highlighting
    let nonAttested = false;
    if (verb[0] === "*") {
      verb = verb.slice(1);
      nonAttested = true;
    }

    if (!root.includes("Ø") && root[0] !== "w") {
      highlightedVerb = [...verb].map((letter, i) => {
        if (verbalAdjective.sound[ps].includes(i)) {
          // if this is a position to highlight
          return "<strong>" + letter + "</strong>";
        } else {
          // if the position is not to be highlighted
          return letter;
        }
      });
    } else if (root[0] === "Ø") {
      highlightedVerb = [...verb].map((letter, i) => {
        if (verbalAdjective.Iweak[ps].includes(i)) {
          // if this is a position to highlight
          return "<strong>" + letter + "</strong>";
        } else {
          // if the position is not to be highlighted
          return letter;
        }
      });
    } else if (root[1] === "Ø") {
      highlightedVerb = [...verb].map((letter, i) => {
        if (verbalAdjective.IIweak[ps].includes(i)) {
          // if this is a position to highlight
          return "<strong>" + letter + "</strong>";
        } else {
          // if the position is not to be highlighted
          return letter;
        }
      });
    } else if (root[2] === "Ø") {
      highlightedVerb = [...verb].map((letter, i) => {
        if (verbalAdjective.IIIweak[ps].includes(i)) {
          // if this is a position to highlight
          return "<strong>" + letter + "</strong>";
        } else {
          // if the position is not to be highlighted
          return letter;
        }
      });
    } else if (root[0] === "w") {
      highlightedVerb = [...verb].map((letter, i) => {
        if (verbalAdjective.Iw[ps].includes(i)) {
          // if this is a position to highlight
          return "<strong>" + letter + "</strong>";
        } else {
          // if the position is not to be highlighted
          return letter;
        }
      });
    } else {
      highlightedVerb = [...verb];
    }
    // we reinstate the asterisk if necessary
    if (nonAttested) highlightedVerb = ["*", ...highlightedVerb];
  } else if (conjugation === "gParticiple") {
    if (root[2] === "Ø") {
      highlightedVerb = highlightVerb(verb, ps, posParticipleIIw);
    } else {
      highlightedVerb = highlightVerb(verb, ps, posParticiple);
    }
  } else {
    highlightedVerb = [...verb];
  }

  // reinstate vetitive prefix if it was removed at the beginning
  if (vetitive) {
    highlightedVerb.unshift(vetitivePrefix);
  }

  return highlightedVerb.join("");
};

export default highlightRoot;
